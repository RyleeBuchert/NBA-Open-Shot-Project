---
title: "Open Shot Project"
author: "Rylee Buchert"
date: '2022-08-03'
output: 
  html_document:
    code_folding: "show"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## NBA Open Shot Project

Load tidyverse and the dataset

```{r load-packages-data echo=FALSE}
library(tidyverse)
library(modelr)
library(nbastatR)
shot_data <- read_csv('shot_data2.csv')

```

Add python here for modifying the dataset

```{r python}

```

Regression for wingspan

```{r predicting-wingspan}
# Get rid of unneeded cols and 
wingspan_data <- shot_data %>%
  select(-game_clock, -shot_clock, -dribbles, -touch_time)

# Create regression dataset of data with wingspan available
regression_data <- wingspan_data %>%
  filter(!is.na(closest_def_wingspan))

# Create dataset of 'na' values
na_data <- wingspan_data %>%
  filter(is.na(closest_def_wingspan))

print(nrow(regression_data) / nrow(shot_data))

# Run regression and predict 'na' wingspan values
wingspan_reg <- lm(closest_def_wingspan~closest_def_height, data=regression_data)
na_data <- add_predictions(na_data, wingspan_reg, var="closest_def_wingspan", type=NULL)
na_data$closest_def_wingspan <- round(na_data$closest_def_wingspan, digit=2)

# Combine datasets
wingspan_data <- rbind(regression_data, na_data)

# Convert defender distance to inches
wingspan_data$closest_def_distance_in <- 12 * wingspan_data$closest_defender_distance
```

Label open shots

```{r label-shots}
# Add open shot based on defender wingspan and 
shot_data <- wingspan_data %>%
  mutate(open_shot = ifelse(closest_def_distance_in > (closest_def_wingspan/2), 1, 0))
```


Describe open shot stat

```{r}
# Drop missing values and get counts for open/contested shot
shot_data %>% 
  drop_na() %>%
  group_by(open_shot) %>% 
  summarise(count = n(), pct = n()/nrow(shot_data)*100)
```


```{r}
# Add team codes from matchup
shot_data <- shot_data %>%
  mutate(home_team_short = if_else(nchar(matchup)==24, 
                            if_else(location=="H", 
                                    substr(matchup,22,24), 
                                    substr(matchup,16,18)), 
                            if_else(location=="H", 
                                    substr(matchup,16,18), 
                                    substr(matchup,24,26))),
         away_team_short = if_else(nchar(matchup)==24, 
                            if_else(location=="H", 
                                    substr(matchup,16,18), 
                                    substr(matchup,22,24)), 
                            if_else(location=="H", 
                                    substr(matchup,24,26), 
                                    substr(matchup,16,18))))

```

Join with games data

```{r}

```